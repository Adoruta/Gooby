#!/bin/bash

source /opt/GooPlex/menus/variables.sh

if [ "$EUID" -ne 0 ]; then

	if [ ! -e $CONFIGS/Docker/.env ]; then
		echo ""
		echo "${YELLOW}Welcome to GooPlex 2-Pre-Alpha!${STD}"
		echo "Please only try this on a FRESH server - there is no upgrade path"
		echo "You will need to have a domain... if you don't have one"
		echo "You will need to keep on using the old GooPlex"
		echo ""
		echo "Honestly, this is NOT production ready!"
		echo "${YELLOW}Please answer the following two questions:${STD}"
		echo ""
		read -e -p 'What domain will you be using to access your server (ex: mydomain.com)?  ' -i "${MYDOMAIN}" MYDOMAIN
		read -e -p 'What is your email address for certificate registration (ex: myname@mydomain.com)  ' -i "${MYEMAIL}" MYEMAIL
		echo "${YELLOW}Thank you! Please hang tight while we get some things ready...${STD}"
		echo ""  && sleep 5
		source /opt/GooPlex/install/server/docker-install.sh
		sudo mkdir -p $CONFIGS/.config
		sudo mkdir -p $CONFIGS/Docker/components
		sudo chown -R $USER:$USER $CONFIGS
		echo "$MYDOMAIN" > $CONFIGS/.config/mydomain
		echo "$MYEMAIL" > $CONFIGS/.config/myemail
		sudo rsync -a /opt/GooPlex/scripts/components/{00-AAA.yaml,01-proxy.yaml} ~
		source /opt/GooPlex/install/misc/environment-build.sh

	fi

	/opt/GooPlex/menus/main.sh

else

	/opt/GooPlex/install/server/user-create.sh

fi
